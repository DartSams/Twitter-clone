<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>

    <!-- <link rel="stylesheet" type= "text/css" href="\twitter clone\static\index.css"> -->
    <link rel="stylesheet" href="{{url_for('static',filename='index.css')}}">
</head>

<!-- <header class="flex-container-header">
    <a href="/" class="flex-item">Website Name</a>
    <a href="/" class="flex-item">Home</a>
    <a href="/" class="flex-item">Shop</a>
    <a href="" class="flex-item">About Us</a>
    <a href="" class="flex-item">Contact</a>
    {% if "username" in session %}
    <a href="/profile" class="flex-item">{{session["username"]}}</a>
    {% elif "username" not in session %}
    <a href="">Login</a>
    {% endif %}
</header> -->

<body>

    <main>
        <!-- <h2 class="title" style="color: white;display: flex; justify-content: center;">Website Users</h2> -->
        <div>
            <form action="" method="post" class="search-bar">
                <input type="text" name="search-bar" placeholder="Search..">
                <button id="4" name="enter-search" value=""><img src="/static/buttons/search-icon.png" alt=""></button>  
            </form>
        </div>

        <div class="container">
            <div class="navbar" style="display: none;">
                <a href="/" class="flex-item"><span>Website Name</span></a>
                <a href="/" class="flex-item" id="active"><span>Home</span></a>
                <a href="/" class="flex-item">Shop</a>
                <a href="" class="flex-item">About Us</a>
                <a href="" class="flex-item">Contact</a>
                {% if "username" in session %}
                <!-- <div class="flex-item">
                    <img src="\static\w3lynx_200.png" alt="" style="width: 10%; height:10%;">
                    <a href="/profile" >{{session["username"]}}</a>
                    <a href="/logout">Logout</a>  
                </div> -->
                <a href="/{{session['username']}}" class="flex-item">{{session["username"]}}</a>
                {% elif "username" not in session %}
                <a href="/login" class="flex-item">Login</a>
                {% endif %}

                <!-- <div class="profile-bar">
                    <img src="\static\w3lynx_200.png" alt="" style="width: 10%; height:10%;" >
                    <a href="/profile" >{{session["username"]}}</a>
                    <a href="/logout" >Logout</a>  
                </div> -->

                <hr>
                <a href="/switch/dartsams" class="flex-item">to dartsams</a>
                <a href="/switch/michael" class="flex-item">to michael</a>

            </div>
                
            

            <div class="all-post">
                <!-- <h3>Post bar</h3> -->
                {% if "username" in session%}
                <form action="" method="POST" enctype=multipart/form-data>
                    <textarea name="post-field" id="myPost" cols="50" rows="5" style="resize: none;"></textarea>
                    <div class="form-buttons">
                        <input type="file" name="file" style="color: white;">
                        <!-- <input type="submit" value="Post"> -->
                        <button type="submit">Post</button>
                    </div>
                </form>
                {%endif%}

                <div class="post-board">
                    <div class="post" >
                        <!-- {{messages}} -->
                        
                        {%for i in data["all post"] %}
                            <!-- {{session["username"]}} -->
                            <!-- <div style="color: blue;">Author:{{i[0]}}</div>
                            <div style="color: blue;">Post Date:{{i[1]}}</div>
                            <div style="color: blue;">Post Time:{{i[2]}}</div>
                            <div style="color: blue;">Post:{{i[3]}}</div>
                            <div style="color: blue;">Post File:{{i[4]}}</div>
                            <div style="color: blue;">Placeholder Date:{{i[5]}}</div>
                            <div style="color: blue;">Post ID:{{i[6]}}</div> -->

                            <a href="/{{i[6]}}">
                            <div class="post-detail" >
                                {% if i[1] == data["post date"] %}
                                <p class="post-name">By {{i[0]}} - {{i[2]}}</p>

                                {% else %}
                                <p class="post-name">By {{i[0]}} - {{i[5]}}</p>

                                {%endif%}

                                <p class="post-body">{{i[3].capitalize()}}</p>
                                
                                {% if i[4] != None %}
                                    {% if 'mp4' == i[4].split(".")[1] %}
                                        <video controls width="320" height="240">
                                            <source src="/static/preview_img/{{i[4].split('.')[0]}}.{{i[4].split('.')[1]}}" type="video/{{i[4].split('.')[1]}}">
                                        Your browser does not support the audio element.
                                        </video>

                                    {%elif 'mp3' == i[4].split(".")[1]%}
                                        <audio controls width="320" height="240">
                                            <source src="/static/preview_img/{{i[4].split('.')[0]}}.{{i[4].split('.')[1]}}" type="audio/{{i[4].split('.')[1]}}">
                                        Your browser does not support the audio element.
                                        </audio>

                                    {%endif%}

                                    {% for pic_type in data["extensions"]%}
                                        {% if pic_type == i[4].split(".")[1] %}
                                            <img src="/static/preview_img/{{i[4]}}" alt="">
                                        {%endif%}
                                    {%endfor%}

                                {%endif%}
                            </a> 
                            <div >
                                <!-- <form action="" method="post" class="post-buttons"> -->
                                    <!-- <label for="reply" onclick="myFunction()" name="Reply">Reply</label> -->
                                    <!-- <input type="image" src="/static/preview_img/6Ty5edK8c.png"> -->

                                    <!-- <label for="retweet" onclick="myFunction()" name="Retweet">Retweet</label> -->
                                    <!-- <input type="image" src="/static/preview_img/6Ty5edK8c.png"> -->

                                    <!-- <label for="like" id="like" onclick="myFunction()">Like</label> -->
                                    <!-- <input type="image" src="/static/preview_img/black heart.png" name="Reply" value="1"> -->
                                    <!-- <input type="image" src="/static/preview_img/black heart.png" name="Retweet">
                                    <input type="image" src="/static/preview_img/black heart.png" name="like">
                                    <input type="image" src="/static/preview_img/black heart.png" name="Share"> -->

                                    <!-- <label for="share" onclick="myFunction()" name="Share">Share</label> -->
                                    <!-- <input type="image" src="/static/preview_img/6Ty5edK8c.png"> -->
                                <!-- </form> -->
                                <!-- <form action="" method="post" class="post-buttons">
                                    <button id="4" name="Reply" class="Reply" value="{{i[6]}}"><img src="/static/preview_img/black heart.png" alt=""></button>  
                                    <button id="4" name="Retweet" class="Retweet" value="{{i[6]}}"><img src="/static/preview_img/black heart.png" alt=""></button>  
                                    <button id="4" name="Like" class="Like" value="{{i[6]}}"><img src="/static/preview_img/black heart.png" alt=""></button>  
                                    <button id="4" name="Share" class="Share" value="{{i[6]}}"><img src="/static/preview_img/black heart.png" alt=""></button>  
                                </form> -->
                                <div class="likes">
                                    <!-- {{like_lst}}  -->
                                    <br>

                                    <form action="" method="post" class="post-buttons">
                                        <button id="4" name="Reply" class="Reply" value="{{i[6]}}"><img src="/static/buttons/reply1.png" alt="">Reply</button>  
                                        <button id="4" name="Retweet" class="Retweet" value="{{i[6]}}"><img src="/static/buttons/retweet.png" alt="">Retweet</button> 
                                        {% if data["like lst"] %}
                                        <!-- {{like_lst}} -->
                                            {% for j in data["like lst"] %}
                                                {% if j[1] == i[6] %}
                                                    {% if session["username"] == j[0] %}
                                                        <!-- {{j[0]}}-{{j[1]}} -->
                                                        <button id="4" name="UnLike" class="Like" value="{{i[6]}}"><img src="/static/buttons/unlike.png" alt="">Like</button>  
                                                    {%endif%}
                                                {%endif%}
                                            {%endfor%}
                                        {%endif%}

                                        {% if i[6] not in data["like lst id"] %}
                                            <button id="4" name="Like" class="Like" value="{{i[6]}}"><img src="/static/buttons/like.png" alt="">Like</button>  
                                        {%endif%}
                                        <button id="4" name="Share" class="Share" value="{{i[6]}}"><img src="/static/buttons/black heart.png" alt="">Share</button>  
                                    </form>        
                                </div>
                            </div>
                        </div>
                        {%endfor%}

                        
                    </div>
                </div>
            </div>
            <!-- <button onclick="myFunction()">Test socket button</button> -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>

            <script type="text/javascript" charset="utf-8">
                var socket = io();
                var username = "{{session['username']}}"
                // socket.on('connect', function() {
                //     socket.send("User has connected");
                //     // socket.emit("message",{data:"hello im new"})
                // });

                socket.on("message",function(msg,name){
                    // var list = document.getElementById('messages');
                    // var entry = document.createElement('li');
                    // console.log(msg)
                    // entry.appendChild(document.createTextNode(`${username} says ${msg.message}`));
                    // list.appendChild(entry);
                    // // alert(`${msg.user} says ${msg.message}`)
                    // document.getElementById('myMessage').value = ''

                    var list = document.getElementById('postList');
                    var entry = document.createElement('p');
                    console.log(msg)
                    entry.appendChild(document.createTextNode(`${msg.user} says ${msg.message}`));
                    list.prepend(entry)
                    // list.appendChild(entry);
                    // alert(`${msg.user} says ${msg.message}`)
                    document.getElementById('myMessage').value = ''
                });

                function myFunction() {
                    let send_message = document.getElementById("myMessage").value;
                    // socket.send(send_message)
                    socket.emit("message",{user:username,message:send_message})
                    // var entry = document.createElement('li');
                    // entry.appendChild(document.createTextNode(send_message));
                    // list.appendChild(entry);
                    // document.getElementById('myMessage').value = ''
                };

                // var list = document.getElementById('messages');
                // // var entry = document.createElement('li');
                var all_post = "{{data['all post']}}"
                // console.log(all_post)
                // for (let i = 0; i< all_post; i++){
                //     // console.log(all_post);
                //     // var list = document.getElementById('messages');
                //     var entry = document.createElement('li');
                //     // console.log(msg)
                //     entry.appendChild(document.createTextNode(i));
                //     list.appendChild(entry);
                // }


                let newElement = document.createElement("ul");
                newElement.setAttribute("id","all-post")
                console.dir(newElement)
                
                // const lst=["hello","world",];
                // for(let i = 0;i<lst.length;i++) {
                //     let item = document.createElement("li");
                //     item.innerHTML = lst[i];
                //     newElement.appendChild(item);
                // }

                // let items = document.createElement("li");
                // items.appendChild(document.createTextNode("hell"));
                // newElement.appendChild(items);



                // newElement.innerHTML=all_post
                document.body.appendChild(newElement);
                
            </script>

            <ul id="messages"></ul>
            <input type="text" id="myMessage">
            <input type="submit" id="sendMessage" onclick="myFunction()">

            <br>
            <br>
            <div id="postList">
                {% for i in data["all post"] %}
                    <p id="postItem">{{i}}</p>
                {%endfor%}
            </div>
                
        </div>
        
        

    </main>
    
</body>

</html>